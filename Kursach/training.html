<!DOCTYPE html>
<html>
	<head><script type="text/javascript" src="/inj_js/common.js"></script><script type="text/javascript" src="/inj_js/common.js"></script>
		<title>training</title>
		<meta name = "viewport" content = "width=device-width,initial-scale=1.0,minimum-scale=1.0,maximum-scale=1.0"/>
		<meta name = "apple-mobile-web-app-capable" content = "yes"/>
		<meta name = "apple-mobile-web-app-status-bar-style" content = "black"/>
		<meta http-equiv = "Content-Type" content = "text/html;charset=utf-8"/>
		<meta http-equiv = "x-ua-compatible" content = "IE=edge"/>
		<!-- Подключение скриптов Babylon.js -->
			<script src = "http://www.babylonjs.com/hand.minified-1.2.js"></script>
			<script src = "babylon.custom.js"></script>
			<script src = "hand-1.3.7.js"></script>
			<script src = "//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
			<script src = "http://www.babylonjs.com/cannon.js"></script>
			<script src = "tween.js"></script>
			<script src = "RequestAnimationFrame.js"></script>
			<script src="velocity.js"></script>
		<!------------------------------------->
		<link rel="stylesheet" href="font/stylesheet.css" type="text/css" charset="utf-8" />
		<style>		
			html,body{overflow:hidden;width:100%;height:100%;margin:0;padding:0;}
			#renderCanvas{width:100%;height:100vh;touch-action:none;}
			#header{font-family: 'WebFont', Arial, sans-serif;font-size:45px;position:absolute;width:100%;height:0px;z-index:1;opacity:1;background-color:#FFFFFF;color:white;}
			#end{display:none;text-align:center;font-size:50pt;font-family:'cubicregular',Arial,sans-serif;position:absolute;top:0;bottom:0;right:0;background:#1e1e1e;overflow:hidden;width:100%;z-index:999;color:white;font-weight:900;}

		</style>
	</head>
	
	<body>

		<div id = "canvasZone">
			<canvas id = "renderCanvas"></canvas>
		</div>

		<script>	
			var canvas = document.getElementById("renderCanvas"); // Создаем холст, который будет выводиться в элементе HTML выше 
			var engine = new BABYLON.Engine(canvas,true); // Загружаем ядро трехмерной обработки BABYLON
			var scene = new BABYLON.Scene(engine); // Создаем простой объект сцены Babylon
			
			// Загружаем саму сцену
			BABYLON.SceneLoader.Load("scene/","training.babylon",engine,function(scene){
				// Сам код происходящего на сцене
				scene.executeWhenReady(function(){
					var camera = scene.activeCamera; // Создаем активную камеру (которая двигается)	
					camera.speed = 1; // Скорость камеры
					camera.maxZ = 200; // Максимальный ZOOM камеры
					camera.attachControl(canvas,true); // Возможность контролировать камеру и передвигать её
					//camera.rotation = new BABYLON.Vector3(Math.PI/4, 19.5, 0);
					
			
					var hero = scene.getMeshByName("hero");
					hero.dispose();
					var Group4122 = scene.getMeshByName("Group#4.122");
					
					var box = BABYLON.Mesh.CreateBox("box",1,scene);
					box.position.x = Group4122.position.x - 0.5;
                    box.position.y = Group4122.position.y + 1.5;
                    box.position.z = Group4122.position.z + 0.5;
							
					var materialBox = new BABYLON.StandardMaterial("textureBox",scene);
					materialBox.diffuseColor = new BABYLON.Color3(1, 1, 0);
					materialBox.specularColor = new BABYLON.Color3(1, 1, 1);
					materialBox.emissiveColor = new BABYLON.Color3(0, 1, 1);
					materialBox.ambientColor = new BABYLON.Color3(1, 1, 1);
                    //box.material = materialBox;
					
					var Group5022 = scene.getMeshByName("Group#5.022");
					var Group5121 = scene.getMeshByName("Group#5.121");
					var Group4127 = scene.getMeshByName("Group#4.127");
					
					var bot4_1 = BABYLON.Mesh.CreateBox("bot4_1",0.999,scene);
					bot4_1.position.x = Group5022.position.x - 2.5;
					bot4_1.position.y = Group5022.position.y + 1.5;
					bot4_1.position.z = Group5022.position.z + 0.5;
					var bot4_2 = BABYLON.Mesh.CreateBox("bot4_2",0.999,scene);
					bot4_2.position.x = bot4_1.position.x+1;
					bot4_2.position.y = bot4_1.position.y;
					bot4_2.position.z = bot4_1.position.z;
					var bot4_3 = BABYLON.Mesh.CreateBox("bot4_3",0.999,scene);
					bot4_3.position.x = bot4_1.position.x;
					bot4_3.position.y = bot4_1.position.y;
					bot4_3.position.z = bot4_1.position.z-1;
					var bot4_4 = BABYLON.Mesh.CreateBox("bot4_4",0.999,scene);
					bot4_4.position.x = bot4_3.position.x+1;
					bot4_4.position.y = bot4_3.position.y;
					bot4_4.position.z = bot4_3.position.z;
					
					bot4_1.material = materialBox;
					bot4_2.material = materialBox;
					bot4_3.material = materialBox;
					bot4_4.material = materialBox;
					
										
					var downPl = new BABYLON.StandardMaterial("textureBox",scene);
					downPl.diffuseColor = new BABYLON.Color3(1, 1, 1);
					downPl.specularColor = new BABYLON.Color3(1, 1, 1);
					downPl.emissiveColor = new BABYLON.Color3(1, 1, 1);
					downPl.ambientColor = new BABYLON.Color3(1, 1, 1);
					
					var down1 = BABYLON.Mesh.CreateBox("down1",1,scene);
					down1.position.x = Group4122.position.x+0.5;
					down1.position.y = Group4122.position.y+0.5;
					down1.position.z = Group4122.position.z+0.5;
					var down2 = BABYLON.Mesh.CreateBox("down2",1,scene);
					down2.position.x = down1.position.x+1;
					down2.position.y = down1.position.y;
					down2.position.z = down1.position.z;
					var down3 = BABYLON.Mesh.CreateBox("down3",1,scene);
					down3.position.x = down2.position.x+1;
					down3.position.y = down2.position.y;
					down3.position.z = down2.position.z;
					var down4 = BABYLON.Mesh.CreateBox("down4",1,scene);
					down4.position.x = down3.position.x+1;
					down4.position.y = down3.position.y;
					down4.position.z = down3.position.z;
					
					var down5 = BABYLON.Mesh.CreateBox("down5",1,scene);
					down5.position.x = Group5121.position.x-0.5;
					down5.position.y = Group5121.position.y+0.5;
					down5.position.z = Group5121.position.z-0.5;
					var down6 = BABYLON.Mesh.CreateBox("down6",1,scene);
					down6.position.x = down5.position.x;
					down6.position.y = down5.position.y;
					down6.position.z = down5.position.z-1;

					down1.material = downPl;
					down2.material = downPl;
					down3.material = downPl;
					down4.material = downPl;
					down5.material = downPl;
					down6.material = downPl;

					var matBTT1 = new BABYLON.StandardMaterial("matBTT1",scene);
					matBTT1.diffuseColor = new BABYLON.Color3(169/256, 169/256, 169/256);
					matBTT1.specularColor = new BABYLON.Color3(92/256, 99/256, 113/256);
					matBTT1.emissiveColor = new BABYLON.Color3(92/256, 99/256,113/256);
					matBTT1.ambientColor = new BABYLON.Color3(92/256, 99/256,113/256);
					
					var btt1 = BABYLON.Mesh.CreateBox("btt1",0.5,scene);
					btt1.position.x = Group4127.position.x-0.5;
					btt1.position.y = Group4127.position.y+0.85; 
					btt1.position.z = Group4127.position.z+0.5; 
					btt1.material = matBTT1; 
					

					var materialF = new BABYLON.StandardMaterial("textureU",scene); // Cоздаем текстуру спутника для движения вперед
					materialF.diffuseColor = new BABYLON.Color3(1,0,0); // Цвет спутника (красный)
					materialF.alpha = 0.5; // Прозрачность спутника
					var f1 = BABYLON.Mesh.CreateBox("f1",0.5,scene); // Создаем первый спутник (с кубом) для движения вперед
					f1.position.x = box.position.x; // Позиция первого спутника в длину
					f1.position.y = box.position.y; // Позиция первого спутника в высоту
					f1.position.z = box.position.z + 0.5; // Позиция первого спутника в ширину
					f1.material = materialF; // Красим первый спутник в красный цвет
					var f2 = BABYLON.Mesh.CreateBox("f2",0.5,scene); // Создаем второй спутник (над кубом) для движения вперед
					f2.position.x = box.position.x; // Позиция второго спутника в длину
					f2.position.y = box.position.y + 1; // Позиция второго спутника в высоту
					f2.position.z = box.position.z + 0.5; // Позиция второго спутника в ширину
					f2.material = materialF; // Красим второй спутник в красный цвет
					
					var materialB = new BABYLON.StandardMaterial("textureU",scene); // Cоздаем текстуру спутника для движения назад
					materialB.diffuseColor = new BABYLON.Color3(0,1,0); // Цвет спутника (зеленый)
					materialB.alpha = 0.5; // Прозрачность спутника
					var b1 = BABYLON.Mesh.CreateBox("b2",0.5,scene); // Создаем первый спутник (с кубом) для движения назад
					b1.position.x = box.position.x; // Позиция первого спутника в длину
					b1.position.y = box.position.y; // Позиция первого спутника в высоту
					b1.position.z = box.position.z - 0.5; // Позиция первого спутника в ширину
					b1.material = materialB; // Красим первый спутник в зеленый цвет
					var b2 = BABYLON.Mesh.CreateBox("b2",0.5,scene); // Создаем второй спутник (над кубом) для движения назад
					b2.position.x = box.position.x; // Позиция второго спутника в длину
					b2.position.y = box.position.y + 1; // Позиция второго спутника в высоту
					b2.position.z = box.position.z - 0.5; // Позиция второго спутника в ширину
					b2.material = materialB; // Красим второй спутник в зеленый цвет
					
					var materialL = new BABYLON.StandardMaterial("textureU",scene); // Cоздаем текстуру спутника для движения влево
					materialL.diffuseColor = new BABYLON.Color3(0,0,1); // Цвет спутника (синий)
					materialL.alpha = 0.5; // Прозрачность спутника
					var l1 = BABYLON.Mesh.CreateBox("l2",0.5,scene); // Создаем первый спутник (с кубом) для движения влево
					l1.position.x = box.position.x - 0.5; // Позиция первого спутника в длину
					l1.position.y = box.position.y + 0; // Позиция первого спутника в высоту
					l1.position.z = box.position.z; // Позиция первого спутника в ширину
					l1.material = materialL; // Красим первый спутник в синий цвет
					var l2 = BABYLON.Mesh.CreateBox("l2",0.5,scene); // Создаем второй спутник (над кубом) для движения влево
					l2.position.x = box.position.x - 0.5; // Позиция второго спутника в длину
					l2.position.y = box.position.y + 1; // Позиция второго спутника в высоту
					l2.position.z = box.position.z; // Позиция второго спутника в ширину
					l2.material = materialL; // Красим второй спутник в синий цвет
					
					var materialR = new BABYLON.StandardMaterial("textureU",scene); // Cоздаем текстуру спутника для движения вправо
					materialR.diffuseColor = new BABYLON.Color3(1,1,1); // Цвет спутника (белый)
					materialR.alpha = 0.5; // Прозрачность спутника
					var r1 = BABYLON.Mesh.CreateBox("r2",0.5,scene); // Создаем первый спутник (с кубом) для движения вправо
					r1.position.x = box.position.x + 0.5; // Позиция первого спутника в длину
					r1.position.y = box.position.y + 0; // Позиция первого спутника в высоту
					r1.position.z = box.position.z; // Позиция первого спутника в ширину
					r1.material = materialR; // Красим первый спутник в белый цвет
					var r2 = BABYLON.Mesh.CreateBox("r2",0.5,scene); // Создаем второй спутник (над кубом) для движения вправо
					r2.position.x = box.position.x + 0.5; // Позиция второго спутника в длину
					r2.position.y = box.position.y + 1; // Позиция второго спутника в высоту
					r2.position.z = box.position.z; // Позиция второго спутника в ширину
					r2.material = materialR; // Красим второй спутник в белый цвет
					
					
					var materialBT = new BABYLON.StandardMaterial("textureU",scene); // Cоздаем текстуру спутника падения
					materialBT.diffuseColor = new BABYLON.Color3(0,1,1); // Цвет спутника (серый)
					materialBT.alpha = 0.5; // Прозрачность спутника
					var bt = BABYLON.Mesh.CreateBox("bt",0.5,scene); // Создаем второй спутник (под кубом) для падения
					bt.position.x = box.position.x; // Позиция спутника в длину
					bt.position.y = box.position.y - 0.5; // Позиция спутника в высоту
					bt.position.z = box.position.z; // Позиция спутника в ширину
					bt.material = materialBT; // Красим спутник в серый цвет
					
					var f1Score = 0; // Создаем переменную для проверки пересечения для первого спутника движения вперед
					var f2Score = 0; // Создаем переменную для проверки пересечения для второго спутника движения вперед
					var b1Score = 0; // Создаем переменную для проверки пересечения для первого спутника движения назад
					var b2Score = 0; // Создаем переменную для проверки пересечения для второго спутника движения назад
					var l1Score = 0; // Создаем переменную для проверки пересечения для первого спутника движения влево
					var l2Score = 0; // Создаем переменную для проверки пересечения для второго спутника движения влево
					var r1Score = 0; // Создаем переменную для проверки пересечения для первого спутника движения вправо
					var r2Score = 0; // Создаем переменную для проверки пересечения для второго спутника движения вправо
					var btScore = 0; // Создаем переменную для проверки пересечения для второго спутника движения вниз
					
					 // Скрыть спутники
                  /*  f1.isVisible = false;
                    f2.isVisible = false;
                    b1.isVisible = false;
                    b2.isVisible = false;
                    r1.isVisible = false;
                    r2.isVisible = false;
                    l1.isVisible = false;
                    l2.isVisible = false;
                    bt.isVisible = false;*/
					
					
					var fired = false;
					var trig = 0;
					
					
					var ppppppp = 0;
					
					
					window.onkeydown = function(event){
						if(!fired){
							if (trig == 0){
						
						setTimeout(function(){box.rotation = BABYLON.Vector3.Zero();}, 330);
						if(event.keyCode==87 || event.keyCode==83 || event.keyCode==65 || event.keyCode==68){fired = true;}
					
							// Проверка на пересечение для движения вперед
							scene.meshes.forEach(function(m){
								if (m.name != "skyBox" && m.name != "f1" && m.name != "f2" && m.name != "r1" && m.name != "r2" && m.name != "l1" && m.name != "l2" && m.name != "b1" && m.name != "b2" && m.name != "hero" && m.name != "box" && m.name != "bt"){ 
									if (f1.intersectsMesh(m,true)){f1Score=1;//console.log(m.name);
									} 
									if (f2.intersectsMesh(m,true)){f2Score=1;//console.log(m.name);
									} 
								}
							});
							
							// Проверка на пересечение для движения назад
							scene.meshes.forEach(function(m){
								 if (m.name != "skyBox" && m.name != "f1" && m.name != "f2" && m.name != "r1" && m.name != "r2" && m.name != "l1" && m.name != "l2" && m.name != "b1" && m.name != "b2" && m.name != "hero" && m.name != "box" && m.name != "bt"){ 
									if (b1.intersectsMesh(m,true)){b1Score=1;//console.log(m.name);
									} 
									if (b2.intersectsMesh(m,true)){b2Score=1;//console.log(m.name);
									} 
								}
							});	
							
							// Проверка на пересечение для движения влево
							scene.meshes.forEach(function(m){
								if (m.name != "skyBox" && m.name != "f1" && m.name != "f2" && m.name != "r1" && m.name != "r2" && m.name != "l1" && m.name != "l2" && m.name != "b1" && m.name != "b2" && m.name != "hero" && m.name != "box" && m.name != "bt"){ 
									if (l1.intersectsMesh(m,true)){l1Score=1;//console.log(m.name);
									} 
									if (l2.intersectsMesh(m,true)){l2Score=1;//console.log(m.name);
									} 
								}
							});	
							
							// Проверка на пересечение для движения вправо
							scene.meshes.forEach(function(m){
								if (m.name != "skyBox" && m.name != "f1" && m.name != "f2" && m.name != "r1" && m.name != "r2" && m.name != "l1" && m.name != "l2" && m.name != "b1" && m.name != "b2" && m.name != "hero" && m.name != "box" && m.name != "bt"){ 
									if (r1.intersectsMesh(m,true)){r1Score=1;//console.log(m.name);
									} 
									if (r2.intersectsMesh(m,true)){r2Score=1;//console.log(m.name);
									} 
								}
							});
						
							
							// Действие при нажатии на клавишу W
							if (event.keyCode == 87){ 
								//step.play();
								if (f1Score == 0 & f2Score == 0) moveforward();
								else if (f1Score == 1 & f2Score == 0){
									moveup();
									moveforward();
								}
							else{fired = false;}	
							}
							
							// Действие при нажатии на клавишу S
							 if (event.keyCode == 83){
								//step.play();
								if (b1Score == 0 & b2Score == 0) movebackward();
								else if (b1Score == 1 & b2Score == 0){
									moveup();
									movebackward();
								} 
								else{fired = false;}
							}
							
							// Действие при нажатии на клавишу A
							 if (event.keyCode == 65){
								//step.play();
								if (l1Score == 0 & l2Score == 0) moveleft();
								else if (l1Score == 1 & l2Score == 0){
									moveup();
									moveleft();
								}
								else{fired = false;}
							}
							
							// Действие при нажатии на клавишу D
							if (event.keyCode == 68){
								//step.play();
								if (r1Score == 0 & r2Score == 0) moveright();
								else if (r1Score == 1 & r2Score == 0){
									moveup();
									moveright();
								}	
								else{fired = false;}		
							}
							
							f1Score = 0;
							f2Score = 0;
							b1Score = 0;
							b2Score = 0;	
							l1Score = 0;
							l2Score = 0;
							r1Score = 0;
							r2Score = 0;	
							btScore = 0;							
						}
					}
					}
					

					// Функция для движения вперед
					function moveforward(){
						//step.play();
						tween = new TWEEN.Tween(box.position).to({z:box.position.z+1},330).start();
						tween.easing(TWEEN.Easing.Cubic.Out);
						tween.yoyo(true);
					
						var tween2 = new TWEEN.Tween(box.rotation).to({z:0,y:0,x:box.rotation.z+Math.PI/2},330).start();
						tween2.easing(TWEEN.Easing.Cubic.Out);				 
						tween2.yoyo(true);	
						
						tween.onComplete(function(){
						
							box.rotation = BABYLON.Vector3.Zero();
							f1.position.z = f1.position.z + 1;
							f2.position.z = f2.position.z + 1;
							b1.position.z = b1.position.z + 1;
							b2.position.z = b2.position.z + 1;
							r1.position.z = r1.position.z + 1;
							r2.position.z = r2.position.z + 1;
							l1.position.z = l1.position.z + 1;
							l2.position.z = l2.position.z + 1;
							bt.position.z = bt.position.z + 1;
							box.rotation = BABYLON.Vector3.Zero();
							fired = false;

						});	
					}	
					
					// Функция для движения назад
					function movebackward(){
						//step.play();
						tween3 = new TWEEN.Tween(box.position).to({z:box.position.z-1},330).start();
						tween3.easing(TWEEN.Easing.Cubic.Out);
						tween3.yoyo(true);
					
						var tween4 = new TWEEN.Tween(box.rotation).to({z:0,y:0,x:box.rotation.z-Math.PI/2},330).start();
						tween4.easing(TWEEN.Easing.Cubic.Out);				 
						tween4.yoyo(true);	
					
						tween3.onComplete(function(){
							box.rotation = BABYLON.Vector3.Zero();
							f1.position.z = f1.position.z - 1;
							f2.position.z = f2.position.z - 1;
							b1.position.z = b1.position.z - 1;
							b2.position.z = b2.position.z - 1;
							r1.position.z = r1.position.z - 1;
							r2.position.z = r2.position.z - 1;	
							l1.position.z = l1.position.z - 1;
							l2.position.z = l2.position.z - 1;
							bt.position.z = bt.position.z - 1;
							box.rotation = BABYLON.Vector3.Zero();
							fired = false;
						});	
					}
					
					// Функция для движения влево
					function moveleft(){
						//step.play();
						tween5 = new TWEEN.Tween(box.position).to({x:box.position.x-1},330).start();
						tween5.easing(TWEEN.Easing.Cubic.Out);
						tween5.yoyo(true);
					
						var tween6 = new TWEEN.Tween(box.rotation).to({x:0,y:0,z:box.rotation.z+Math.PI/2},330).start();
						tween6.easing(TWEEN.Easing.Cubic.Out);				 
						tween6.yoyo(true);
						
						tween5.onComplete(function(){
							box.rotation = BABYLON.Vector3.Zero();
							f1.position.x = f1.position.x - 1;
							f2.position.x = f2.position.x - 1;
							b1.position.x = b1.position.x - 1;
							b2.position.x = b2.position.x - 1;
							r1.position.x = r1.position.x - 1;
							r2.position.x = r2.position.x - 1;			
							l1.position.x = l1.position.x - 1;
							l2.position.x = l2.position.x - 1;
							bt.position.x = bt.position.x - 1;
							box.rotation = BABYLON.Vector3.Zero();
							fired = false;
						});
					
					
					}
					
					// Функция для движения вправо
					function moveright(){
						//step.play();
						tween7 = new TWEEN.Tween(box.position).to({x:box.position.x+1},330).start();
						tween7.easing(TWEEN.Easing.Cubic.Out);
						tween7.yoyo(true);
					
						var tween8 = new TWEEN.Tween(box.rotation).to({x:0,y:0,z:box.rotation.z-Math.PI/2},330).start();
						tween8.easing(TWEEN.Easing.Cubic.Out);				 
						tween8.yoyo(true);
						
						tween7.onComplete(function() {
							box.rotation = BABYLON.Vector3.Zero();
							f1.position.x = f1.position.x + 1;
							f2.position.x = f2.position.x + 1;
							b1.position.x = b1.position.x + 1;
							b2.position.x = b2.position.x + 1;
							r1.position.x = r1.position.x + 1;
							r2.position.x = r2.position.x + 1;
							l1.position.x = l1.position.x + 1;
							l2.position.x = l2.position.x + 1;
							bt.position.x = bt.position.x + 1;
							box.rotation = BABYLON.Vector3.Zero();
							fired = false;
						});		
					}
					
					// Функция для подъёма
                    function moveup(){
						// step.play();
                        tween9 = new TWEEN.Tween(box.position).to({y:box.position.y+1},330).start();
                                                tween9.easing(TWEEN.Easing.Cubic.Out);
                                                tween9.yoyo(true);
                                       
                                                var tween10 = new TWEEN.Tween(box.rotation).to({z:0,y:0,x:box.rotation.x-Math.PI/2},330).start();
                                                tween10.easing(TWEEN.Easing.Cubic.Out);                          
                                                tween10.yoyo(true);
                                               
                                                tween10.onComplete(function(){
                                                        box.rotation = BABYLON.Vector3.Zero();
                                                        f1.position.y = f1.position.y + 1;
                                                        f2.position.y = f2.position.y + 1;
                                                        b1.position.y = b1.position.y + 1;
                                                        b2.position.y = b2.position.y + 1;
                                                        r1.position.y = r1.position.y + 1;
                                                        r2.position.y = r2.position.y + 1;
                                                        l1.position.y = l1.position.y + 1;
                                                        l2.position.y = l2.position.y + 1;
                                                        bt.position.y = bt.position.y + 1;                                                     
                                                        box.rotation = BABYLON.Vector3.Zero();
                                                        fired = false;
                                                });    
                                        }
					
					// Функция для падения
					 function  movedown(){  
                        mm = "0";
                        scene.meshes.forEach(function(m){
                            if (m.name != "skyBox" && m.name != "f1" && m.name != "f2" && m.name != "r1" && m.name != "r2" && m.name != "l1" && m.name != "l2" && m.name != "b1" && m.name != "b2" && m.name != "hero" && m.name != "box" && m.name != "bt"){
                                if (bt.intersectsMesh(m,true)){btScore=1; 
									if(m.name == "down1"){
										setInterval(function(){
											tween100 = new TWEEN.Tween(down1.position).to({y:-5.5}, 100).start();
											tween100.easing(TWEEN.Easing.Exponential.Out);
											tween100.yoyo(true);
											}, 750);
									}
									if(m.name == "down2"){
										setInterval(function(){
											tween100 = new TWEEN.Tween(down2.position).to({y:-5.5}, 100).start();
											tween100.easing(TWEEN.Easing.Exponential.Out);
											tween100.yoyo(true);
											}, 750);
									}
									if(m.name == "down3"){
										setInterval(function(){
											tween100 = new TWEEN.Tween(down3.position).to({y:-5.5}, 100).start();
											tween100.easing(TWEEN.Easing.Exponential.Out);
											tween100.yoyo(true);
											}, 750);
									}
									if(m.name == "down4"){
										setInterval(function(){
											tween100 = new TWEEN.Tween(down4.position).to({y:-5.5}, 100).start();
											tween100.easing(TWEEN.Easing.Exponential.Out);
											tween100.yoyo(true);
											}, 750);
									}
									if(m.name == "down5"){
										setInterval(function(){
											tween100 = new TWEEN.Tween(down5.position).to({y:-5.5}, 100).start();
											tween100.easing(TWEEN.Easing.Exponential.Out);
											tween100.yoyo(true);
											}, 750);
									}
									if(m.name == "down6"){
										setInterval(function(){
											tween100 = new TWEEN.Tween(down6.position).to({y:-5.5}, 100).start();
											tween100.easing(TWEEN.Easing.Exponential.Out);
											tween100.yoyo(true);
											}, 750);
									}
									
									if(m.name == "btt1")
									{
										
										f1.position.z = 17;
										f2.position.z = 17;
										l1.position.z = 16.5;
										l2.position.z = 16.5;
										b1.position.z = 16;
										b2.position.z = 16;
										r1.position.z = 16.5;
										r2.position.z = 16.5;
										//bt.position.z = box.position.z;	

										
										tween500 = new TWEEN.Tween(box.position).to({z:16.5},400).start();
										tween500.easing(TWEEN.Easing.Linear.None);
										tween500.yoyo(true);
										tween500 = new TWEEN.Tween(box.rotation).to({z:0,y:0,x:box.rotation.z-3*Math.PI/2},400).start();
										tween500.easing(TWEEN.Easing.Linear.None);				 
										tween500.yoyo(true);
										tween500 = new TWEEN.Tween(bt.position).to({z:16.5},400).start();
										tween500.easing(TWEEN.Easing.Linear.None);
										tween500.yoyo(true);
										
										
									}
										
								
                                    if(m.name == "bot4_2") ppppppp = 1;
									else ppppppp = 0;
                                    console.log(m.name);
                                    mm = m.name;
                                }
                            }
                        });
                        if (btScore == 0){                    
                            box.position.y = box.position.y - 1;
                            f1.position.y = f1.position.y - 1;
                            f2.position.y = f2.position.y - 1;
                            b1.position.y = b1.position.y - 1;
                            b2.position.y = b2.position.y - 1;
                            r1.position.y = r1.position.y - 1;
                            r2.position.y = r2.position.y - 1;
                            l1.position.y = l1.position.y - 1;
                            l2.position.y = l2.position.y - 1;
                            bt.position.y = bt.position.y - 1;
                        }
 
                        if(mm == "0"){
                            box.position.y = box.position.y - 1;
                            f1.position.y = f1.position.y - 1;
                            f2.position.y = f2.position.y - 1;
                            b1.position.y = b1.position.y - 1;
                            b2.position.y = b2.position.y - 1;
                            r1.position.y = r1.position.y - 1;
                            r2.position.y = r2.position.y - 1;
                            l1.position.y = l1.position.y - 1;
                            l2.position.y = l2.position.y - 1;
                            bt.position.y = bt.position.y - 1;
                        }
                    }
					
					
					var max = 256;
					var min = 0;
					
					var BoxMaterial = new BABYLON.StandardMaterial("material01",scene);
					
					function colorich(){

						var diffuse = new BABYLON.Color3(Math.floor(Math.random()*(max - min) + min)/255,Math.floor(Math.random()*(max - min) + min)/255,Math.floor(Math.random()*(max - min) + min)/255);
						var specular = new BABYLON.Color3(Math.floor(Math.random()*(max - min) + min)/255,Math.floor(Math.random()*(max - min) + min)/255,Math.floor(Math.random()*(max - min) + min)/255);
						BoxMaterial.specularPower = 16;
						var ambient = new BABYLON.Color3(Math.floor(Math.random()*(max - min) + min)/255,Math.floor(Math.random()*(max - min) + min)/255,Math.floor(Math.random()*(max - min) + min)/255);
						var emissive = new BABYLON.Color3(Math.floor(Math.random()*(max - min) + min)/255,Math.floor(Math.random()*(max - min) + min)/255,Math.floor(Math.random()*(max - min) + min)/255);
						
						tween = new TWEEN.Tween(BoxMaterial.diffuseColor).to(diffuse,1000).start();
						tween.easing(TWEEN.Easing.Cubic.Out);
						tween.yoyo(true);
						
						tween1 = new TWEEN.Tween(BoxMaterial.specularColor).to(specular,1000).start();
						tween1.easing(TWEEN.Easing.Cubic.Out);
						tween1.yoyo(true);	

						tween2 = new TWEEN.Tween(BoxMaterial.ambientColor).to(ambient,1000).start();
						tween2.easing(TWEEN.Easing.Cubic.Out);
						tween2.yoyo(true);		
						
						tween3 = new TWEEN.Tween(BoxMaterial.emissiveColor).to(emissive,1000).start();
						tween3.easing(TWEEN.Easing.Cubic.Out);
						tween3.yoyo(true);	
													
						box.material = BoxMaterial;
				
					}
					setInterval(colorich, 1500);
					
	
			
					// Указывает браузеру на то, что вы хотите произвести анимацию, и просит его запланировать перерисовку на следующем кадре анимации
					requestAnimationFrame(animate);
					function animate(time){
						requestAnimationFrame(animate);
						TWEEN.update(time);

					}
	

					setInterval(bot4block, 2000);			
					
					
					
					// Регистрируем цикл отрисовки, который периодически обновляет сцену (FPS)
					engine.runRenderLoop(function(){
						scene.render();	
						movedown();
						
						/*if ((bot4_2.intersectsMesh(box,true) || bot4_4.intersectsMesh(box,true))){ 
						if(ppppppp != 1){
								trig = 1;
								box.position.x = bot4_2.position.x + 1;
								f1.position.x = box.position.x;
								f2.position.x = box.position.x;
								l1.position.x = box.position.x-0.5;
								l2.position.x = box.position.x-0.5;
								b1.position.x = box.position.x;
								b2.position.x = box.position.x;
								r1.position.x = box.position.x+0.5;
								r2.position.x = box.position.x+0.5;
								bt.position.x = box.position.x;	
}
else
{box.position.x = bot4_2.position.x;
								f1.position.x = box.position.x;
								f2.position.x = box.position.x;
								l1.position.x = box.position.x-0.5;
								l2.position.x = box.position.x-0.5;
								b1.position.x = box.position.x;
								b2.position.x = box.position.x;
								r1.position.x = box.position.x+0.5;
								r2.position.x = box.position.x+0.5;
								bt.position.x = box.position.x;		}								
						}
						else{trig = 0;}*/

						
						
						
					});
					
					function bot4block(){
						tween100 = new TWEEN.Tween(bot4_1.position).to({x:4.5}, 1000).start();
                        tween100.easing(TWEEN.Easing.Linear.None);
                        tween100.yoyo(true);
						tween100 = new TWEEN.Tween(bot4_2.position).to({x:5.5}, 1000).start();
                        tween100.easing(TWEEN.Easing.Linear.None);
                        tween100.yoyo(true);
						tween100 = new TWEEN.Tween(bot4_3.position).to({x:4.5}, 1000).start();
                        tween100.easing(TWEEN.Easing.Linear.None);
                        tween100.yoyo(true);
						tween100 = new TWEEN.Tween(bot4_4.position).to({x:5.5}, 1000).start();
                        tween100.easing(TWEEN.Easing.Linear.None);
                        tween100.yoyo(true);
						tween100.onComplete(function(){
							tween101 = new TWEEN.Tween(bot4_1.position).to({x:2.5}, 1000).start();
							tween101.easing(TWEEN.Easing.Linear.None);
							tween101.yoyo(true);
							tween101 = new TWEEN.Tween(bot4_2.position).to({x:3.5}, 1000).start();
							tween101.easing(TWEEN.Easing.Linear.None);
							tween101.yoyo(true);
							tween101 = new TWEEN.Tween(bot4_3.position).to({x:2.5}, 1000).start();
							tween101.easing(TWEEN.Easing.Linear.None);
							tween101.yoyo(true);
							tween101 = new TWEEN.Tween(bot4_4.position).to({x:3.5}, 1000).start();
							tween101.easing(TWEEN.Easing.Linear.None);
							tween101.yoyo(true);
						});
					}
					

				});
			});
			
			
			
			// Отслеживаем изменения размера окна браузера и (или) холста
			window.addEventListener("resize",function(){
					engine.resize();
			});

		</script>
	</body>
</html>